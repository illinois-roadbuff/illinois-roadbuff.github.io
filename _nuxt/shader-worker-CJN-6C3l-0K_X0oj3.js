(function(){"use strict";(function(){function M(t,n,s){return s=Math.max(0,Math.min(1,(s-t)/(n-t))),s*s*(3-2*s)}function T(t,n){return Math.sqrt(t*t+n*n)}function w(t,n,s,o,c){const e=Math.abs(t)-s+c,a=Math.abs(n)-o+c;return Math.min(Math.max(e,a),0)+T(Math.max(e,0),Math.max(a,0))-c}function X(t,n){return{x:t,y:n}}function S(t,n){const s=Math.sin(t*12.9898+n*78.233)*43758.5453;return(s-Math.floor(s))*2-1}function E(t,n,s=4){let o=0,c=.5,e=1;for(let a=0;a<s;a++)o+=c*S(t*e,n*e),c*=.5,e*=2;return o}const I={liquidGlass:t=>{const n=t.x-.5,s=t.y-.5,o=w(n,s,.3,.2,.6),c=M(.8,0,o-.15),e=M(0,1,c);return X(n*e+.5,s*e+.5)},flowingLiquid:t=>{const n=t.x-.5,s=t.y-.5,o=w(n,s,.3,.2,1),c=M(.8,0,o-.15),e=M(0,1,c);return X(n*e+.5,s*e+.5)},transparentIce:t=>{const n=t.x-.5,s=t.y-.5,o=E(t.x*8,t.y*8,3)*.05,c=S(t.x*20,t.y*20)*.02,e=w(n,s,.35,.25,.3),a=M(.5,-.2,e),r=Math.sin(t.x*15+o*10)*Math.cos(t.y*12)*.03,i=n+(o+c+r)*a,f=s+(o*.8+c)*a,d=M(0,.1,e)*.1;return X(i*(1-d)+.5,f*(1-d)+.5)},unevenGlass:t=>{const n=t.x-.5,s=t.y-.5,o=E(t.x*3,t.y*3,2)*.08,c=S(t.x*6+o,t.y*6)*.04,e=n+o*.3,a=s+o*.3,r=w(e,a,.32,.22,.4),i=M(.6,-.1,r),f=Math.sin(t.x*8+o*5)*Math.sin(t.y*8)*.02,d=i*(1+c*.5),m=n+(o+f)*d,g=s+(o*.9+c+f*.7)*d;return X(m+.5,g+.5)},mosaicGlass:t=>{const n=t.x-.5,s=t.y-.5,o=.05,c=Math.floor(t.x/o),e=Math.floor(t.y/o),a=Math.sin(c*12.9898+e*78.233)*43758.5453,r=a-Math.floor(a),i=r*Math.PI*2,f=Math.cos(i)*.03,d=Math.sin(i)*.03,m=w(n,s,.35,.25,.05),g=M(.4,-.1,m),l=t.x%o/o,h=t.y%o/o,y=.1,D=l<y||l>1-y||h<y||h>1-y,x=S(c*3.7,e*3.7)*.02,u=(r-.5)*.04;let Y,k;if(D)Y=x*.2,k=x*.2;else{const p=1+u;Y=(f+x)*p,k=(d+x)*p}const q=Y*g,b=k*g;return X(n+q+.5,s+b+.5)}};self.onmessage=t=>{const{width:n,height:s,effect:o,mousePosition:c,time:e}=t.data,a=n,r=s;let i=0;const f=[];for(let l=0;l<r;l++)for(let h=0;h<a;h++){const y={x:h/a,y:l/r},D=I[o](y,c,e),x=D.x*a-h,u=D.y*r-l;i=Math.max(i,Math.abs(x),Math.abs(u)),f.push(x,u)}i>0?i=Math.max(i,1):i=1;const d=new ImageData(a,r),m=d.data;let g=0;for(let l=0;l<r;l++)for(let h=0;h<a;h++){const y=f[g++],D=f[g++],x=Math.min(h,l,a-h-1,r-l-1),u=Math.min(1,x/2),Y=y*u,k=D*u,q=Y/i+.5,b=k/i+.5,p=(l*a+h)*4;m[p]=Math.max(0,Math.min(255,q*255)),m[p+1]=Math.max(0,Math.min(255,b*255)),m[p+2]=Math.max(0,Math.min(255,b*255)),m[p+3]=255}self.postMessage({imageData:d},[d.data.buffer])}})()})();
